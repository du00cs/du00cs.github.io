<!DOCTYPE HTML>

    <html lang="zh-Hans">
  
<head>
  <meta charset="utf-8">
  
  <title>Spark/Scala极速入门材料 | Oh Captain, My Captain - Du00</title>
  <meta name="author" content="Du00">
  
  <meta name="description" content="Du00的博客">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Spark/Scala极速入门材料"/>
  <meta property="og:site_name" content="Oh Captain, My Captain - Du00"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <meta http-equiv="Content-Language" content="zh-Hans"/>
  

  <link href="/img/favicon.png" rel="icon">
  
    <link rel="apple-touch-icon" href="/img/apple-icon.png">
    <link rel="apple-touch-icon-precomposed" href="/img/apple-icon.png">
    

  <link rel="alternate" href="/atom.xml" title="Oh Captain, My Captain - Du00" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  <style type="text/css">
  /* Tim Pietrusky advanced checkbox hack (Android <= 4.1.2) */
body{ -webkit-animation: bugfix infinite 1s; }
@-webkit-keyframes bugfix { from {padding:0;} to {padding:0;} }

  
  <!-- Chinese readability improvements -->
    article {font-weight: 400;letter-spacing: .01rem;}
    article .entry{line-height:2;}
  

  
    article .post-content-index .entry{ overflow:hidden;}
  
</style>

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56718947-1', 'auto');
  ga('send', 'pageview');
 
</script>




  
    <!-- 360 Font and Baidu CDN in China -->
    
      <link href='http://fonts.useso.com/css?family=Open+Sans:300,400|Playball' rel='stylesheet' type='text/css'>
    
  <link href='http://apps.bdimg.com/libs/fontawesome/4.1.0/css/font-awesome.css' rel='stylesheet' type='text/css'>
  <script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
  



</head>


<body>
  <header id="header" class="inner"><div class="padding">
	<div class="alignleft logo">
	  <h1><a href="/">Oh Captain, My Captain - Du00</a></h1>
	</div>
	<nav id="main-nav" class="alignright">
		<input type="checkbox" id="toggle" />
		<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu" onclick><i class="fa fa-bars"></i></label>
	  <ul class="menu">
	    
	      <li><a href="/">Home</a></li>
	    
	      <li><a href="/archives">Archives</a></li>
	    
	    
	  </ul>
	</nav>
	<div class="clearfix"></div>
</div>
</header>
  <div id="page-heading-wrap">
  	<div class="inner">
      <div class="padding">
    		
          <h1>Spark/Scala极速入门材料</h1>
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2014-11-11T07:09:26.000Z">2014-11-11</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">Du00</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="#ds-thread"><span class="ds-thread-count" data-thread-key="2014/11/spark-scala-introduction/" data-count-type="comments"></span></a>
              
            </li>
          </ul>
        
      </div>
  	</div>
  </div>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper" class="padding"><article class="post">
  
  
    <div class="post-content">
  
      
      <div class="entry">
        
          <p>Spark/Scala的一点入门材料，希望能对想快速了解的人有所帮助，对自己则是一个备忘。</p>
<h2 id="Scala极速入门">Scala极速入门</h2><p>如果需要一些感性认识，可以先读一读Scala的<a href="http://www.scala-lang.org/what-is-scala.html" target="_blank" rel="external">官方介绍</a>。简单地说，Scala是一种更偏函数式的函数式、命令式的混合编程语言，同时也是面向对象的，函数是顶级对象，运行在Java虚拟机上，能与Java无缝结合。</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaomi.data.ctr.feature.analysis</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Scala极速入门材料，可以直接贴入ScalaIDE的worksheet</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">test</span> &#123;</span></span><br><span class="line">  println(<span class="string">"Welcome to the Scala worksheet"</span>)       <span class="comment">//&gt; Welcome to the Scala worksheet</span></span><br><span class="line">  <span class="comment">//val(ue) 是引用不变，不能改变val值变量的『值』</span></span><br><span class="line">  <span class="function"><span class="keyword">val</span> <span class="title">n</span> =</span> <span class="number">8</span>                                       <span class="comment">//&gt; n  : Int = 8</span></span><br><span class="line">  <span class="comment">//n += 1 : value += is not a member of Int</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//var(riable) 是变量，能用val用val，技穷用var</span></span><br><span class="line">  <span class="keyword">var</span> nn = <span class="number">7</span>                                      <span class="comment">//&gt; nn  : Int = 7</span></span><br><span class="line">  nn += <span class="number">1</span></span><br><span class="line">  nn                                              <span class="comment">//&gt; res0: Int = 8</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//tuple - 使用得非常重的数据结构，同python，但是不能（显式地）按下标取到每个元素</span></span><br><span class="line">  <span class="function"><span class="keyword">val</span> <span class="title">t</span> =</span> (<span class="number">1</span>, <span class="string">"a"</span>, <span class="type">None</span>)                          <span class="comment">//&gt; t  : (Int, String, None.type) = (1,a,None)</span></span><br><span class="line">  t._1                                            <span class="comment">//&gt; res1: Int = 1</span></span><br><span class="line">  t._2                                            <span class="comment">//&gt; res2: String = a</span></span><br><span class="line">  t._3                                            <span class="comment">//&gt; res3: None.type = None</span></span><br><span class="line">  <span class="comment">//纯语法，相信看过就不会忘记的</span></span><br><span class="line">  <span class="function"><span class="keyword">val</span> (</span>no, name, score) = t                       <span class="comment">//&gt; no  : Int = 1</span></span><br><span class="line">                                                  <span class="comment">//| name  : String = a</span></span><br><span class="line">                                                  <span class="comment">//| score  : None.type = None</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//collections, 取下标用()</span></span><br><span class="line">  <span class="function"><span class="keyword">val</span> <span class="title">list</span> =</span> <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)                        <span class="comment">//&gt; list  : List[Int] = List(1, 2, 3)</span></span><br><span class="line">  list(<span class="number">0</span>)                                         <span class="comment">//&gt; res4: Int = 1</span></span><br><span class="line">  <span class="function"><span class="keyword">val</span> <span class="title">m</span> =</span> <span class="type">Map</span>(</span><br><span class="line">    <span class="string">"a"</span> -&gt; <span class="number">1</span>,</span><br><span class="line">    <span class="string">"c"</span> -&gt; <span class="number">2</span>,</span><br><span class="line">    <span class="string">"b"</span> -&gt; <span class="number">3</span>,</span><br><span class="line">    <span class="string">"d"</span> -&gt; <span class="number">4</span>)                                     <span class="comment">//&gt; m  : scala.collection.immutable.Map[String,Int] = Map(a -&gt; 1, c -&gt; 2, b -&gt; 3</span></span><br><span class="line">                                                  <span class="comment">//| , d -&gt; 4)</span></span><br><span class="line">  <span class="comment">//取前两个</span></span><br><span class="line">  m.take(<span class="number">2</span>)                                       <span class="comment">//&gt; res5: scala.collection.immutable.Map[String,Int] = Map(a -&gt; 1, c -&gt; 2)</span></span><br><span class="line">  m(<span class="string">"a"</span>)                                          <span class="comment">//&gt; res6: Int = 1</span></span><br><span class="line">  <span class="comment">//删除一个键，得到一个新的map</span></span><br><span class="line">  m - <span class="string">"a"</span>                                         <span class="comment">//&gt; res7: scala.collection.immutable.Map[String,Int] = Map(c -&gt; 2, b -&gt; 3, d -&gt;</span></span><br><span class="line">                                                  <span class="comment">//| 4)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//函数：变量名在前、类型在后，函数头到函数体之间有“=”号</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isPalindrome</span>(</span>str: <span class="type">String</span>) = (str == str.reverse.toString())</span><br><span class="line">                                                  <span class="comment">//&gt; isPalindrome: (str: String)Boolean</span></span><br><span class="line">  <span class="comment">//函数：可以显式指定返回值类型，函数的返回值就是最后一行的值</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isPalindromeDetail</span>(</span>str: <span class="type">String</span>): <span class="type">Boolean</span> = &#123;</span><br><span class="line">    println(str)</span><br><span class="line">    str == str.reverse.toString</span><br><span class="line">  &#125;                                               <span class="comment">//&gt; isPalindromeDetail: (str: String)Boolean</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isPalindromeDetailUn</span>(</span>str: <span class="type">String</span>): <span class="type">Boolean</span> = ???</span><br><span class="line">                                                  <span class="comment">//&gt; isPalindromeDetailUn: (str: String)Boolean</span></span><br><span class="line">  <span class="comment">//函数式编程：map/filter/reduce，其它的基本都是变种</span></span><br><span class="line">  <span class="function"><span class="keyword">val</span> <span class="title">ab</span> =</span> <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)                 <span class="comment">//&gt; ab  : List[Int] = List(1, 2, 3, 4, 5, 6)</span></span><br><span class="line">  <span class="comment">//每个元素乘3</span></span><br><span class="line">  ab.map(_ * <span class="number">3</span>)                                   <span class="comment">//&gt; res8: List[Int] = List(3, 6, 9, 12, 15, 18)</span></span><br><span class="line">  <span class="comment">//取出偶数</span></span><br><span class="line">  ab.filter(_ % <span class="number">2</span> == <span class="number">0</span>)                           <span class="comment">//&gt; res9: List[Int] = List(2, 4, 6)</span></span><br><span class="line">  <span class="comment">//reduce实现sum</span></span><br><span class="line">  ab.reduce(_ + _)                                <span class="comment">//&gt; res10: Int = 21</span></span><br><span class="line">  <span class="comment">//reduce实现max</span></span><br><span class="line">  ab.reduce((x, y) =&gt; <span class="keyword">if</span> (x &gt; y) x <span class="keyword">else</span> y)        <span class="comment">//&gt; res11: Int = 6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<!-- more >

一种是“对集合中的每个东西，东西在哪儿，取出来，执行某个操作”，另一种是“对一个集合中的每一个元素执行操作”。
具体的函数式编程与命令式编程语言的区别网上铺天盖地的，推荐一篇精简（是否得当就不评论了）的介绍（我自己参考写的……）《[课程学习Couresera - Functional Programming Principles in Scala - Week 1](/2014/11/11/课程学习Couresera-Functional-Programming-Principles-in-Scala-Week-1)》

## Scala相关资料
- 以后最常用的是会是这个：[Scala Standard Library API Docs](http://www.scala-lang.org/api/current/#package)，也许你会觉得看完也不知道毡哪个，但是你确实得依赖它。
- 书籍：多看上面是有本书的——《[Scala程序设计：Java虚拟机多核编程实战](http://www.duokan.com/book/68639)》，其它的还有很多，如《**Scala for the Impatient**》，《**Programming in Scala: A comprehensive Step-by-step Guide**》
- [Coursera](https://class.coursera.org)上有一门用Scala讲的函数式编程语言的课——*Functional Programming Principles in Scala*，需要注意的是可能从头学到尾都不知道还有`var`这个东西，因为这门课真的只讲函数式编程。另外，请不要惊讶做作业需要花很长时间。
如果你是跟我一样的懒人，还是去Coursera上面上一课吧，系统地学一学对整体把握有好处。
- 方方同学补充： [typesafe activetor](http://www.typesafe.com/)上有不少代码模板，Twitter内部大量使用Scala并且开办了[Scala School](https://twitter.github.io/scala_school/index.html)

## Spark入门
![RDD操作](http://du00.qiniudn.com/网页配图-RDD操作.png)
Spark简单说来就只是三步：Create (RDD)，Transform (RDD)和Action(非RDD)
1. Create
常见的创建方式有三种（均是从一个SparkContext实例开始）：
 - textFile
 - sequenceFile
 - parallize，从一个Scala Collection开始
textFile/sequenceFile两个方法已经可以解决来自HDFS的所有类型的记录文件，parallize用于测试，读hbase等其它的，略麻烦，不是一条语句能搞定了。
2. Transform
 - 基本的：map/filter
 - 处理key-value：groupByKey, reduceByKey, combineByKey等等
这部分必须熟练掌握，PairRDDFunctions在`import org.apache.spark.SparkContext._`过后就可以自动的给类型是`RDD[(K, V)]`的rdd加上PairRDDFunctions里面的所有方法了。注意：Transform的输入是RDD，输出仍然是RDD。
3. Action
Action会完成RDD向基本数据类型的转换，结果不再是RDD，一般来说就是收集结果到driver结点或者直接写HDFS了。作为Hadoop的用户会一定要会使用`saveAsTextFile`和`saveAsSequeceFile`，收集结果用collect()或者reduce()到driver结点完成或其它操作。

## Spark工程
建一个maven工程，pom里面写上
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.4.0-mdh2.0.5<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="title">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>asm<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>asm<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.jboss.netty<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>netty<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">exclusions</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spark-core_2.10<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">version</span>&gt;</span>4.8.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.scalatest<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>scalatest_2.10<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">artifactSet</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">include</span>&gt;</span><span class="tag">&lt;/<span class="title">include</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="title">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">artifactSet</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="title">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">execution</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="title">phase</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="title">goal</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="title">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- maven的scala支持插件，适当的时候可以去用一用新的版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>net.alchim31.maven<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>scala-maven-plugin<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">version</span>&gt;</span>3.1.3<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">execution</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="title">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">goal</span>&gt;</span>testCompile<span class="tag">&lt;/<span class="title">goal</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="title">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>下面是一个代码实例，完成的工作是将格式为<br><code>label    pos1:value1 pos2:value2 ... post:valuen#imei,appid</code><br>的样本文件中去掉<code>0, 37, 38, 39, 51</code>五列的值。<br><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> demo</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span>._</span><br><span class="line"><span class="keyword">import</span> com.xiaomi.data.ctr.feature.analysis.<span class="type">AppstoreRecordParser</span>.getSampleRdd</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.compress.<span class="type">GzipCodec</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 从base中去除 0, 37, 38, 39, 51五维特征</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">SampleReduction</span> &#123;</span></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 定义一个用于解析出来的记录的载体类，为什么这样就可以了？语法</span><br><span class="line">   */</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">AppStoreRecord</span>(</span></span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">imei</span>:</span> <span class="type">String</span>,</span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">appid</span>:</span> <span class="type">Int</span>,</span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">label</span>:</span> <span class="type">Int</span>,</span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">pv</span>:</span> <span class="type">Map</span>[<span class="type">Int</span>, <span class="type">Double</span>])</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 解析一条记录的函数</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parseRecord</span>(</span>line: <span class="type">String</span>): <span class="type">AppStoreRecord</span> = &#123;</span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">cols</span> =</span> line.split(<span class="string">"\t"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">label</span> =</span> cols(<span class="number">0</span>).toInt</span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">splits</span> =</span> cols(<span class="number">1</span>).split(<span class="string">"#"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">Array</span>(</span>imei, appId) = splits(<span class="number">1</span>).split(<span class="string">","</span>)</span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">pvPart</span> =</span> splits(<span class="number">0</span>).split(<span class="string">" "</span>)</span><br><span class="line">    splits(<span class="number">1</span>).split(<span class="string">","</span>)(<span class="number">0</span>)</span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">values</span> =</span> pvPart.map(cell =&gt; &#123; <span class="function"><span class="keyword">val</span> <span class="title">t</span> =</span> cell.split(<span class="string">":"</span>); (t(<span class="number">0</span>).toInt, t(<span class="number">1</span>).toDouble) &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="type">AppStoreRecord</span>(imei, appId.toInt, label, values.toMap)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 需要有这个函数来成为入口，同java的main函数，格式固定</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span>(</span>args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//固定，不可少</span></span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">sparkConf</span> =</span> <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"Sample Reduction"</span>)</span><br><span class="line">    <span class="comment">//外部执行spark程序时，master会指定，这里手工指定方便在IDE中跑起来</span></span><br><span class="line">    <span class="keyword">if</span> (!sparkConf.contains(<span class="string">"spark.master"</span>)) sparkConf.setMaster(<span class="string">"local[4]"</span>)</span><br><span class="line">    println(<span class="string">"master: "</span> + sparkConf.get(<span class="string">"spark.master"</span>))</span><br><span class="line">    <span class="comment">//固定，必有这么一句</span></span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">sc</span> =</span> <span class="keyword">new</span> <span class="type">SparkContext</span>(sparkConf)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">val</span> <span class="title">zeroFeatures</span> =</span> <span class="type">Array</span>(<span class="number">0</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">51</span>)</span><br><span class="line"></span><br><span class="line">    sc</span><br><span class="line">      <span class="comment">//create RDD</span></span><br><span class="line">      .textFile(args(<span class="number">0</span>))</span><br><span class="line">      <span class="comment">//transform 1</span></span><br><span class="line">      .map(parseRecord)</span><br><span class="line">      <span class="comment">//transform 2</span></span><br><span class="line">      <span class="comment">//保存为label[tab]pos:value[space]...#imei,appid</span></span><br><span class="line">      .map(t =&gt; &#123;</span><br><span class="line">        t.label + <span class="string">"\t"</span> + (t.pv -- zeroFeatures).map &#123; <span class="keyword">case</span> (p, v) =&gt; p + <span class="string">":"</span> + v &#125;.mkString(<span class="string">" "</span>) + <span class="string">"#"</span> + t.imei + <span class="string">","</span> + t.appid</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//action</span></span><br><span class="line">      .saveAsTextFile(args(<span class="number">1</span>), classOf[<span class="type">GzipCodec</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// spark自带的例子里面都有这么一句</span></span><br><span class="line">    sc.stop</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>IDE之类的操作训不在讲解范围之内了，打包好之后用以下语句执行即可（主jar包后而一定只有程序参数，或其它参数都向前站）：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">spark-submit \</span><br><span class="line">    --master yarn-client \</span><br><span class="line">    --num-executors <span class="number">3</span> \</span><br><span class="line">    --executor-memory <span class="number">2</span>G \</span><br><span class="line">    --queue user_profile_default \</span><br><span class="line">    --class com.your.mainclass \</span><br><span class="line">    target/feature-analysis-<span class="number">0.0</span>.<span class="number">1</span>-SNAPSHOT.jar \</span><br><span class="line">    各种参数</span><br></pre></td></tr></table></figure></p>
<p>可以在工程下而建一个脚本来省去一些公共参数的填写<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line"><span class="comment"># 用于提交任务至yarn的脚本，参数：</span></span><br><span class="line"><span class="comment"># class 参数1...</span></span><br><span class="line"></span><br><span class="line">class=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">shift</span></span><br><span class="line"></span><br><span class="line">spark-submit \</span><br><span class="line">    --master yarn-client \</span><br><span class="line">    --num-executors <span class="number">3</span> \</span><br><span class="line">    --executor-memory <span class="number">2</span>G \</span><br><span class="line">    --queue user_profile_default \</span><br><span class="line">    --class <span class="variable">$class</span> \</span><br><span class="line">    target/feature-analysis-<span class="number">0.0</span>.<span class="number">1</span>-SNAPSHOT.jar \</span><br><span class="line">    <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Spark相关资料">Spark相关资料</h2><ul>
<li>Spark官网材料，简易的<a href="https://spark.apache.org/docs/latest/programming-guide.html">Programming Guide</a>，以及以后你经常会访问的<a href="https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.package">API Docs</a>，将来会看很多很多遍，但是至少需要基本掌握<a href="https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.SparkContext">SparkContext</a>、<a href="https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.rdd.RDD">RDD</a>和<a href="https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.rdd.PairRDDFunctions">PairRDDFunctions</a>这三个类，你会发现处理日志基本就够用了~</li>
<li>公开课: <em>开课吧</em>上而有这么一门课，《<a href="http://www.kaikeba.com/courses/60">Spark实战演练</a>》，而且还是免费的，虽然授课老师表情、动作、语气和语调都不丰富，但是毕竟是免费的嘛~我不会告诉你上而还有度娘的office系列课程的。</li>
<li>电子书: 《<a href="https://www.safaribooksonline.com/library/view/learning-spark/9781449359034/">Learning Spark</a>》Safari上有前几章的在线观看，也可以去下个PDF，我找到的只有95页……</li>
<li>演示文档: <a href="http://www.slideshare.net/">SlideShare</a>上面一大堆一大堆的，不过就别指望能给你实在的一步一步怎么做了。需要翻墙，还是希望国人在国外的网站上还是要自律，自己嘴上一时爽却妨碍了其它人访问有用的资源。<br>如果你跟我一样是个懒人，还是去<em>开课吧</em>上面上一课吧，不要觉得我是在打广告，我是真的懒……</li>
</ul>
<h2 id="小结">小结</h2><p>　　Spark结合Scala学习起来会有一定成本，但是对于尔等程序员一辈子要学习数十上百种语言人，一定是毫无压力的！一个人可以维护的代码量是有限的，用Spark/Scala确实是可以把自己从大段大段的Java重复代码中解脱出来。当然了，熟练才能解脱……你需要坚持到把Scala那些奇怪的东西消化掉，Google/AOL是好朋友，好好利用。</p>
-->
        
      </div>
      <footer>
        
          
  
  <div class="categories">
    <a href="/categories/Spark/">Spark</a>
  </div>

          
  
  <div class="tags">
    <a href="/tags/Scala/">Scala</a>, <a href="/tags/Spark/">Spark</a>
  </div>

          <div class="share">
  

    
      <!-- JiaThis Button BEGIN -->
      <div class="jiathis_style_24x24">
        <a class="jiathis_button_qzone"></a>
        <a class="jiathis_button_tsina"></a>
        <a class="jiathis_button_tqq"></a>
        <a class="jiathis_button_weixin"></a>
        <a class="jiathis_button_renren"></a>
        <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
        <a class="jiathis_counter_style"></a>
        </div>
        <script type="text/javascript" src="http://v3.jiathis.com/code_mini/jia.js" charset="utf-8"></script>
        <!-- JiaThis Button END -->
    

    

    
  
</div>
          
<nav class="article-nav clearfix">
 
 <div class="article-prev" >
 <a href="/2014/11/coursera-func-scala/" title="Functional Programming Principles in Scala - Week 1">
  <i class="fa fa-long-arrow-left"></i>
  <span>
  Functional Programming Principles in Scala - Week 1</span>
</a>
</div>


<div class="article-next">
<a href="/2014/11/Github-Pages-good-night/"  title="Github Pages, 晚安">
 <span>Github Pages, 晚安
</span>
<i class="fa fa-long-arrow-right"></i>
</a>
</div>

</nav>

        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>


<section id="comment">
  <h2 class="title">留言</h2>

  

     <!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2014/11/spark-scala-introduction/" data-title="Spark/Scala极速入门材料" data-url="http://du00cs.github.com2014/11/spark-scala-introduction/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"du00cs"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->

  
</section>

</div></div>
    <aside id="sidebar" class="alignright"><div class="padding">
	
	  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:du00cs.github.com">
  </form>
</div>
	
	  
<div class="widget recent-post">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/03/spark-map-mapvalues/">Spark学习——map &amp; mapValues</a>
      </li>
    
      <li>
        <a href="/2014/12/spark-tips-01/">Spark问题备忘</a>
      </li>
    
      <li>
        <a href="/2014/12/scala-tips-01/">Scala点点滴滴-JSON/正则/命令行解析</a>
      </li>
    
      <li>
        <a href="/2014/11/hexo-github-pages-3/">利用GitHub搭建个人博客-美化(3)</a>
      </li>
    
      <li>
        <a href="/2014/11/hexo-github-pages-2/">利用GitHub搭建个人博客-利其器(2)</a>
      </li>
    
  </ul>
</div>

	
	  
<div class="widget category">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/Java/">Java</a><small>1</small></li>
  
    <li><a href="/categories/Scala/">Scala</a><small>1</small></li>
  
    <li><a href="/categories/Spark/">Spark</a><small>3</small></li>
  
    <li><a href="/categories/工具/">工具</a><small>3</small></li>
  
    <li><a href="/categories/杂谈/">杂谈</a><small>1</small></li>
  
    <li><a href="/categories/笔记/">笔记</a><small>1</small></li>
  
  </ul>
</div>

	
	  
<div class="widget tag">
  <h3 class="title">标签</h3>
  
    <a href="/tags/Coursera/">Coursera<small>1</small></a>
  
    <a href="/tags/Java/">Java<small>1</small></a>
  
    <a href="/tags/Scala/">Scala<small>6</small></a>
  
    <a href="/tags/Spark/">Spark<small>3</small></a>
  
    <a href="/tags/hexo/">hexo<small>3</small></a>
  
    <a href="/tags/杂谈/">杂谈<small>1</small></a>
  
</div>

	
</div></aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="padding">
	<div class="alignleft">
	  
	  &copy; 2015 Du00
	  
	  Powerd by <a href="http://hexo.io/" target="_blank">hexo</a>
	  and Theme by <a href="https://github.com/halfer53/metro-light" target="_blank">metro-light</a>
	</div>

	<div class="alignright">
		
		
			<a href="https://github.com/du00cs" target="_blank" title="Du00 Github"><i class="fa fa-github-square"></i></a>	
		
		
		
			<a href="http://www.weibo.com/du00cs" target="_blank" title="Du00 Weibo"><i class="fa fa-weibo"></i></a>	
		
		
		
		
	</div>

	<div class="clearfix"></div>
</div>

<div class="scroll-top"><i class="fa fa-arrow-circle-up"></i></div></footer>
  

 <script type="text/javascript">
var duoshuoQuery = {short_name:"du00cs"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>



<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.0.4/jquery.imagesloaded.js"></script>
<script src="/js/gallery.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<script type="text/javascript">
$(window).scroll(function() {

    if($(this).scrollTop() > 400) {
        $('.scroll-top').fadeIn(200);
    } else {
        $('.scroll-top').fadeOut(200);
    }
});

$('.scroll-top').bind('click', function(e) {
    e.preventDefault();
    $('body,html').animate({scrollTop:0},200);
});
</script>


</body>
</html>
